<html> 
    
    <body> 

        {% include 'AgriTrust/header.html' with user=user %}

        <a href = "{% url 'loan_list' %}"> &lt; Back </a>

        <p> {{ loan.id }} </p>
        <p> {{ loan.client }} </p>
        <p> {{ loan.amount_loaned }} </p>
        <p> {{ loan.interest_percentage }} </p>
        <p> {{ loan.loan_term }} </p>
        <p> {{ loan.interest_mode }} </p>
        <p> {{ loan.interest }} </p>
        <p> {{ loan.total }} </p>
        <p> {{ loan.days_total }} </p>
        <p> {{ loan.days_paid }} </p>
        <p> {{ loan.total_amount_paid }} </p>
        <p> {{ loan.status }} </p>
        <p> {{ loan.date_created }} </p>
        <p> {{ loan.date_end }} </p>
        <p> {{ loan.daily_payment }} </p>
        <p> {{ loan.days_left }} </p>

        <canvas id = "qrcode-image"> {{loan.qr_code}} </canvas>

        <!-- Payments table -->
        <div>
            <h3> Payments History </h3> 
            
            <table>
                <tr >
                    <th> ID </th>
                    <th> Amount </th>
                    <th> Date </th>
                </tr>

                {%for payment in payments%}
                    <tr>
                        <td> {{payment.id}} </td>
                        <td> {{payment.amount}} </td>
                        <td> {{payment.date}} </td>
                    </tr>
                {% endfor %}
            </table>
        
        </div>
    </body>

    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script> 

        const setQrCode = () => {
            const qrcode = '{{ loan.qr_code }}';
            const qrcodeContainer = document.getElementById("qrcode-image");

            console.log(qrcode);
            QRCode.toCanvas(qrcodeContainer, qrcode, { width: 200, errorCorrectionLevel: 'H' }, function (error) {
                if (error) {
                    console.error(error);
                    alert("Failed to generate QR code.");
                } else {
                    console.log("QR Code generated successfully!");
                }
            });

        }

        setQrCode();


    </script> 

</html>